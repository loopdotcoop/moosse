<!DOCTYPE HTML>
<html lang="en-GB">
<head>




<!-- META -->

<!-- Technical meta -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
   content="width=device-width, initial-scale=1.0, shrink-to-fit=no,
            maximum-scale=1.0, user-scalable=no">

<!-- Search engine meta -->
<title>Moosse 0.3.2</title>
<meta name="description"
   content="Mutable Objects Over Server-Sent Events.
   A Node.js server which push-notifies endusers when shared resources change">
<link rel="author" href="README.md">

<!-- Twitter Card, and Open Graph for Facebook, LinkedIn, Google+, etc -->
<meta name="twitter:card"    content="summary">
<meta name="twitter:site"    content="@loopdotcoop">
<meta name="twitter:creator" content="@richplastow">
<meta property="og:type"     content="website">
<meta property="og:locale"   content="en_GB">
<meta property="og:title"    content="Moosse">
<meta property="og:url"      content="http://moosse.loop.coop/">
<meta property="og:image"
       content="http://moosse.loop.coop/support/asset/logo/logo-1200x900.svg">
<meta property="og:description"
       content="Mutable Objects Over Server-Sent Events.
       A Node.js server which push-notifies endusers when shared resources change">

<!-- From realfavicongenerator.net - see README.md for settings -->
<link rel="apple-touch-icon" sizes="180x180" href="support/asset/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="96x96" href="support/asset/icon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="32x32" href="support/asset/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="support/asset/icon/favicon-16x16.png">
<link rel="manifest"                  href="support/asset/icon/manifest.json">
<link rel="mask-icon" color="#993300" href="support/asset/icon/safari-pinned-tab.svg">
<link rel="shortcut icon"             href="support/asset/icon/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Moosse">
<meta name="application-name"           content="Moosse">
<meta name="msapplication-config"       content="support/asset/icon/browserconfig.xml">
<meta name="theme-color"                content="#993300">




<!-- STYLE -->

<!-- Load fonts as soon as possible -->
<style>
@font-face { font-family: 'Ubuntu'; font-weight: 400; font-style: normal;
  src: local('Ubuntu Regular'), local('Ubuntu-Regular')
    , url(support/asset/font/ubuntu-regular.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA
    , U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
@font-face { font-family: 'Ubuntu'; font-weight: 400; font-style: italic;
  src: local('Ubuntu Italic'), local('Ubuntu-Italic')
    , url(support/asset/font/ubuntu-italic.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA
    , U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
@font-face { font-family: 'Ubuntu'; font-weight: 700; font-style: normal;
  src: local('Ubuntu Bold'), local('Ubuntu-Bold')
    , url(support/asset/font/ubuntu-bold.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA
    , U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
@font-face { font-family: 'Ubuntu'; font-weight: 700; font-style: italic;
  src: local('Ubuntu Bold Italic'), local('Ubuntu-BoldItalic')
    , url(support/asset/font/ubuntu-bolditalic.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA
    , U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
@font-face { font-family: 'Ubuntu Mono'; font-weight: 400; font-style: normal;
  src: local('Ubuntu Mono'), local('UbuntuMono-Regular')
    , url(support/asset/font/ubuntumono-regular.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA
    , U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}
</style>

<!-- Load styles -->
<link rel="stylesheet" href="support/asset/css/bootstrap.4.0.0.min.css">
<link rel="stylesheet" href="support/asset/css/main.css">




</head>
<body id="home" class="at-top show-burger">
<div class="container">




<!-- Header and Navigation menu -->
<!-- <h2>Moosse 0.3.2</h2> -->
<header>

  <a href="http://moosse.loop.coop/" class="logo-wrap">
    <span id="logo-image">
      <img class="logo" alt="Oom.Foo Logo" src="support/asset/logo/logo-1200x1000-tow.svg">
    </span>
    <span id="logo-text" class="d-none d-md-block">
      <img class="logo" alt="Oom.Foo Logo" src="support/asset/logo/logo-1200x1000-tow.svg">
    </span>
  </a>

  <nav>
    <div class="burger">_<br>_<br>_</div>
    <a href="#about">About</a>
    <a href="support/demo.html">Demo</a>
    <a href="support/test.html">Test</a>
    <a href="#fork">Fork</a>
    <a href="#config">Config</a>
    <a href="#faq">FAQ</a>
    <a href="https://www.npmjs.com/package/moosse">NPM</a>
    <a href="https://github.com/loopdotcoop/moosse">Repo</a>
  </nav>

</header>
<!-- scroll-down shows header --><script>this.addEventListener('scroll',function
(e){document.body.classList[300>e.pageY?'add':'remove']('at-top')})</script>
<!-- show burger-menu --><script>document.querySelector('nav').addEventListener(
'click',function(e){document.body.classList.toggle('show-burger')})</script>


<div id="intro">
  <div class="logo-wrap">
    <img class="logo" alt="Oom.Foo Logo" src="support/asset/logo/logo-1200x1000-tow.svg">
    <h2>Mutable Objects Over Server-Sent Events</h2>
    <h4>A Node.js server which push-notifies endusers when shared resources change</h4>
  </div>
</div>

<div id="bkgnd"></div>


<div id="main">
<!-- Begin section pasted from the repo -->

<h2 id="about">About</h2>
<p>TODO: About text</p>

<h4><a id="user-content-author" class="anchor" aria-hidden="true" href="#author"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Author</h4>
<p>Designed, developed and authored by Rich Plastow for Loop.Coop.</p>
<ul>
<li><strong>Website:</strong>
<a href="http://richplastow.com/" rel="nofollow">richplastow.com</a>
<a href="https://loop.coop/" rel="nofollow">loop.coop</a></li>
<li><strong>GitHub:</strong>
<a href="https://github.com/richplastow">richplastow</a>
<a href="https://github.com/loopdotcoop">loopdotcoop</a></li>
<li><strong>Twitter:</strong>
<a href="https://twitter.com/richplastow" rel="nofollow">@richplastow</a>
<a href="https://twitter.com/loopdotcoop" rel="nofollow">@loopdotcoop</a></li>
<li><strong>Location:</strong>
Brighton, UK and Himachal Pradesh, India</li>
</ul>
<h4><a id="user-content-app" class="anchor" aria-hidden="true" href="#app"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>App</h4>
<ul>
<li><strong>Locales:</strong>
<ul>
<li>English</li>
</ul>
</li>
<li><strong>Software:</strong>
<ul>
<li>Atom</li>
<li>Git</li>
</ul>
</li>
<li><strong>Languages:</strong>
<ul>
<li>HTML5</li>
<li>CSS3</li>
<li>JavaScript ES6</li>
</ul>
</li>
<li><strong>Dependencies:</strong>
<ul>
<li>None!</li>
</ul>
</li>
</ul>

<h2 id="config">Config</h2>
<p>TODO: Config intro</p>

<h4><a id="user-content-namespace" class="anchor" aria-hidden="true" href="#namespace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Namespace</h4>
<p>The global namespace is <code>window.OOMPSH</code> in a browser, or <code>global.OOMPSH</code> in the
Node.js server.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span> <span class="pl-k">=</span> {}</pre></div>
<h4><a id="user-content-configuration" class="anchor" aria-hidden="true" href="#configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h4>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span>.<span class="pl-smi">configuration</span> <span class="pl-k">=</span> {

    <span class="pl-c1">VERSION</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>0.3.0<span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">//</span> the major part of this is also the API version, `APIV`</span>
  , <span class="pl-k">get</span> <span class="pl-en">APIV</span> () { <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>v<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span>.<span class="pl-smi">configuration</span>.<span class="pl-c1">VERSION</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">'</span>.<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>] }

    <span class="pl-c"><span class="pl-c">//</span>// Used as one of the default `domain` values in the frontend UI.</span>
  , remoteURL<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>https://oompsh.herokuapp.com<span class="pl-pds">'</span></span>

    <span class="pl-c"><span class="pl-c">//</span>// Part of the response with various errors.</span>
  , apiURL<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>https://github.com/loopdotcoop/oompsh#api<span class="pl-pds">'</span></span>
  , validatorsURL<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>https://github.com/loopdotcoop/oompsh#validators<span class="pl-pds">'</span></span>

    <span class="pl-c"><span class="pl-c">//</span>// Maximum number of characters in...</span>
  , maxMessageLength<span class="pl-k">:</span> <span class="pl-c1">2048</span> <span class="pl-c"><span class="pl-c">//</span> a 'notify' message</span>
  , maxTitleLength<span class="pl-k">:</span> <span class="pl-c1">256</span> <span class="pl-c"><span class="pl-c">//</span> an 'add' title</span>

    <span class="pl-c"><span class="pl-c">//</span>// Validators for the first character of a username or password, and for</span>
    <span class="pl-c"><span class="pl-c">//</span>// subsequent characters.</span>
  , c1<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[a-zA-Z0-9!()_`~@<span class="pl-cce">\'</span>"^]<span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">//</span> not allowed to start with . or -</span>
  , c2<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[a-zA-Z0-9!()_`~@<span class="pl-cce">\'</span>"^.-]<span class="pl-pds">'</span></span>

    <span class="pl-c"><span class="pl-c">//</span>// Initial values for the server’s ‘very very verbose’ and ‘very verbose’.</span>
  , vvv<span class="pl-k">:</span> <span class="pl-c1">false</span> <span class="pl-c"><span class="pl-c">//</span> very very verbose logging @TODO implement</span>
  , vv<span class="pl-k">:</span>  <span class="pl-c1">true</span>  <span class="pl-c"><span class="pl-c">//</span> very verbose logging (must be true if `vvv` is true) @TODO implement</span>

}</pre></div>
<h4><a id="user-content-api" class="anchor" aria-hidden="true" href="#api"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h4>
<p>Request URLs can have up to four parts:</p>
<ol>
<li>Oompsh <strong>API version,</strong> currently <code>v0</code>. This is the only mandatory part</li>
<li><strong>Credentials,</strong> in the form <code>&lt;my-username&gt;:&lt;my-password&gt;</code>. Oompsh expects HTTPS!</li>
<li>An <strong>action,</strong> eg <code>version</code>, <code>begin</code> or <code>notify</code></li>
<li>A <strong>filter,</strong> eg <code>all</code>, <code>admin</code>, <code>enduser</code>, or an SSE client ID, eg <code>a1b2c3</code> <em>[@TODO ID filter]</em></li>
</ol>
<p>Requests must be sent with the correct method for that action, either <code>GET</code> or
<code>POST</code>. All <code>POST</code> requests require credentials.</p>
<p>Some of the <code>POST</code> actions, eg <code>notify</code>, also expect a request body to be sent, which
should be JSON data. <em>[@TODO more POST actions with body]</em></p>
<p>The <code>begin</code> action is a special case:</p>
<ul>
<li>It starts a ‘Server-Sent Events’ session, so needs headers like
<code>Accept: text/event-stream</code> — you’ll probably use <code>new EventSource()</code> for this.</li>
<li>If the URL contains credentials, an <strong>admin</strong> SSE session is opened, which listens
for server log events. The filter can be blank, <code>vv</code> or <code>vvv</code> <em>[@TODO vv, vvv]</em></li>
<li>If the URL <em>does not</em> contain credentials, an <strong>enduser</strong> SSE session is
opened, which listens for data update events. The filter should be a
comma-delimited list of WordPress post-types, eg <code>post,page,my-cpt</code> <em>[@TODO post types]</em></li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">OOMPSH</span> <span class="pl-k">=</span> <span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span>
<span class="pl-k">const</span> <span class="pl-c1">api</span> <span class="pl-k">=</span> <span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span>.<span class="pl-smi">api</span> <span class="pl-k">=</span> {

    <span class="pl-c"><span class="pl-c">//</span>// Endusers can only GET:</span>
    enduser<span class="pl-k">:</span> {
        <span class="pl-c1">GET</span><span class="pl-k">:</span>  {
            <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span><span class="pl-k">:</span>         { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Retrieves a description of the API<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>version<span class="pl-pds">'</span></span><span class="pl-k">:</span>  { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/version<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Shows the app’s name and version<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>begin<span class="pl-pds">'</span></span><span class="pl-k">:</span>    { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>new EventSource('v0/connect/post,page,my-cpt')<span class="pl-pds">"</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Starts an enduser SSE session<span class="pl-pds">'</span></span> }
        }
      , <span class="pl-c1">POST</span><span class="pl-k">:</span> { }
    }

    <span class="pl-c"><span class="pl-c">//</span>// Admins can do everything endusers can do, plus:</span>
  , admin<span class="pl-k">:</span> {
        <span class="pl-c1">GET</span><span class="pl-k">:</span>  {
            <span class="pl-s"><span class="pl-pds">'</span>begin<span class="pl-pds">'</span></span><span class="pl-k">:</span>    { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>new EventSource('v0/usr:pwd/connect')<span class="pl-pds">"</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Starts an admin SSE session<span class="pl-pds">'</span></span> }
        }
      , <span class="pl-c1">POST</span><span class="pl-k">:</span> {
            <span class="pl-s"><span class="pl-pds">'</span>soft-end<span class="pl-pds">'</span></span><span class="pl-k">:</span> { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/usr:pwd/soft-end/enduser<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Asks SSE clients to close<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>hard-end<span class="pl-pds">'</span></span><span class="pl-k">:</span> { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/usr:pwd/hard-end/enduser<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Forces SSE clients to close<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>notify<span class="pl-pds">'</span></span><span class="pl-k">:</span>   { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"message":"Hello SSEs!"}<span class="pl-pds">'</span></span>
                          <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> POST /v0/usr:pwd/notify/all<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Sends a message to SSE clients<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>test<span class="pl-pds">'</span></span><span class="pl-k">:</span>     { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/usr:pwd/test<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Runs the test-suite<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>add<span class="pl-pds">'</span></span><span class="pl-k">:</span>      { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":123, "title":"New Foo!"}<span class="pl-pds">'</span></span>
                          <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> POST /v0/usr:pwd/add/foo-bar<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Tells endusers an item was created<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>edit<span class="pl-pds">'</span></span><span class="pl-k">:</span>     { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":123, "title":"Old Foo"}<span class="pl-pds">'</span></span>
                          <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> POST /v0/usr:pwd/edit/foo-bar<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Tells endusers an item was modified<span class="pl-pds">'</span></span> }
          , <span class="pl-s"><span class="pl-pds">'</span>delete<span class="pl-pds">'</span></span><span class="pl-k">:</span>   { eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":123}<span class="pl-pds">'</span></span>
                          <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> POST /v0/usr:pwd/delete/foo-bar<span class="pl-pds">'</span></span>
                       , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Tells endusers an item was removed<span class="pl-pds">'</span></span> }
        }
    }

    <span class="pl-c"><span class="pl-c">//</span>// The Oompsh server responds with one of these HTTP status codes.</span>
  , status<span class="pl-k">:</span> {
        <span class="pl-c1">200</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>OK<span class="pl-pds">'</span></span>
      , <span class="pl-c1">401</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>UNAUTHORIZED<span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">//</span> nb, Oompsh doesn’t send a WWW-Authenticate header</span>
      , <span class="pl-c1">404</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>NOT FOUND<span class="pl-pds">'</span></span>
      , <span class="pl-c1">405</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>METHOD NOT ALLOWED<span class="pl-pds">'</span></span>
      , <span class="pl-c1">406</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>NOT ACCEPTABLE<span class="pl-pds">'</span></span>
      <span class="pl-c"><span class="pl-c">//</span> , 500: 'INTERNAL SERVER ERROR'</span>
      , <span class="pl-c1">501</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>NOT IMPLEMENTED<span class="pl-pds">'</span></span>
    }

    <span class="pl-c"><span class="pl-c">//</span>// 6000-8999: Ok.</span>
  , ok<span class="pl-k">:</span> {

        <span class="pl-c"><span class="pl-c">//</span>// 6000-6999: GET and OPTIONS.</span>
        <span class="pl-c1">6000</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Retrieve the Oompsh API<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">6100</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/version<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Retrieve the Oompsh version<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">6900</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>OPTIONS /<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>You're probably a CORS preflight<span class="pl-pds">"</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 7000-7999: POST.</span>
      , <span class="pl-c1">7010</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/o:k/soft-end/all<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Soft-End all<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">7020</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/o:k/hard-end/all<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Hard-End all<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">7030</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"message":"Hi!"} POST /v0/o:k/notify/all<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Notified n admin(s), n enduser(s)<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">7040</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":1,"title":"A"} POST /v0:o:k:add/post<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>'add' sent to n 'post' enduser(s)<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">7050</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":2,"title":"B"} POST /v0:o:k:edit/my-cpt<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>'edit' sent to n 'my-cpt' enduser(s)<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">7060</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"id":3,"title":"C"} POST /v0:o:k:delete/post<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>'delete' sent to n 'post' enduser(s)<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">7990</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/o:k/test<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Run tests<span class="pl-pds">'</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 8000-4999: Admin and enduser SSE.</span>
      , <span class="pl-c1">8000</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">200</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/begin<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Enduser SSE session is open<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">8010</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>soft-end<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Asks SSE clients to close<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8020</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>hard-end<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Warn before hard-end SSE clients<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8030</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>message<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>notify<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Sends a message to SSE clients<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8040</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>bread<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>add<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An item was created<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8050</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>bread<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>edit<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An item was modified<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8060</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>bread<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>delete<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An item was removed<span class="pl-pds">"</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 8500-8999: Admin SSE logs.</span>
      , <span class="pl-c1">8500</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>begin<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An SSE session opened<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8510</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>onSSEClientClose<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An SSE session closed<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">8520</span><span class="pl-k">:</span> { <span class="pl-c1">event</span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>, type<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>hard-end<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>An admin closed some SSE sessions<span class="pl-pds">"</span></span> }

    }

    <span class="pl-c"><span class="pl-c">//</span>// 9000-9999: Errors.</span>
  , error<span class="pl-k">:</span> {

        <span class="pl-c"><span class="pl-c">//</span>// 9000-9099: Oompsh startup errors.</span>
        <span class="pl-c"><span class="pl-c">//</span>// @TODO</span>

        <span class="pl-c"><span class="pl-c">//</span>// 9100-9199: Errors serving a file.</span>
        <span class="pl-c1">9100</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">404</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /no-such-path!<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>No such path...<span class="pl-pds">'</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 9200-9299: URL-format errors.</span>
      , <span class="pl-c1">9200</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">501</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v9999<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Wrong API version<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9210</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">401</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/-:-<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Invalid credentials<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9211</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">401</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/x:x<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Credentials not recognised<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9220</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">401</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/-:-<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Invalid credentials<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9221</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">401</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/x:x<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Credentials not recognised<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9222</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">401</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/notify<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Can't POST without credentials<span class="pl-pds">"</span></span> }
      , <span class="pl-c1">9230</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">404</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/o:k/non-existant<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>No such action...<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9231</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">404</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/non-existant<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>No such action...<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9240</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">404</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/o:k/non-existant<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>No such action...<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9260</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>POST /v0/o:k/soft-end/NO!<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Invalid filter...<span class="pl-pds">'</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 9300-9399: General header and body errors.</span>
      , <span class="pl-c1">9300</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">405</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>DELETE /v0<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Use GET, POST or OPTIONS<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9320</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY [ POST /v0/o:k/notify/all<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Unparseable body<span class="pl-pds">'</span></span> }
      , <span class="pl-c1">9330</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY 5 POST /v0/o:k/notify/all<span class="pl-pds">'</span></span>, tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>Non-object body<span class="pl-pds">'</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 9400-9499: SSE session errors.</span>
      , <span class="pl-c1">9400</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>GET /v0/begin without Accept header<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>Missing 'Accept: text/event-stream' header<span class="pl-pds">"</span></span> }

        <span class="pl-c"><span class="pl-c">//</span>// 9500-9999: Errors specific to actions.</span>
      , <span class="pl-c1">9530</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"No":"Message"} POST /v0/o:k/notify/all<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">`</span>Body should be '{"message":"Hi!"}'<span class="pl-pds">`</span></span> }
      , <span class="pl-c1">9540</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"title":"No ID!"} POST /v0/o:k/add/page<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">`</span>Body should be '{"id":9,"title":"A New Page"}'<span class="pl-pds">`</span></span> }
      , <span class="pl-c1">9550</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"title":"No ID!"} POST /v0/o:k/edit/page<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">`</span>Body should be '{"id":9,"title":"An Updated Page"}'<span class="pl-pds">`</span></span> }
      , <span class="pl-c1">9560</span><span class="pl-k">:</span> { status<span class="pl-k">:</span><span class="pl-c1">406</span>, eg<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>BODY {"not-id":9} POST /v0/o:k/delete/page<span class="pl-pds">'</span></span>
          , tip<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">`</span>Body should be '{"id":9}'<span class="pl-pds">`</span></span> }
    }

  , code<span class="pl-k">:</span> <span class="pl-c1">6000</span> <span class="pl-c"><span class="pl-c">//</span> every API response has a code</span>
}

<span class="pl-c"><span class="pl-c">//</span>// Duplicate all enduser actions to admin.</span>
<span class="pl-smi">api</span>.<span class="pl-smi">admin</span>.<span class="pl-c1">GET</span>  <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">assign</span>({}, <span class="pl-smi">api</span>.<span class="pl-smi">enduser</span>.<span class="pl-c1">GET</span>, <span class="pl-smi">api</span>.<span class="pl-smi">admin</span>.<span class="pl-c1">GET</span>)
<span class="pl-smi">api</span>.<span class="pl-smi">admin</span>.<span class="pl-c1">POST</span> <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">assign</span>({}, <span class="pl-smi">api</span>.<span class="pl-smi">enduser</span>.<span class="pl-c1">POST</span>, <span class="pl-smi">api</span>.<span class="pl-smi">admin</span>.<span class="pl-c1">POST</span>)</pre></div>
<h4><a id="user-content-validators" class="anchor" aria-hidden="true" href="#validators"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Validators</h4>
<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">OOMPSH</span> <span class="pl-k">=</span> <span class="pl-c1">ROOT</span>.<span class="pl-c1">OOMPSH</span>
    , { c1, c2, maxMessageLength<span class="pl-k">:</span>mml, maxTitleLength<span class="pl-k">:</span>mtl }
        <span class="pl-k">=</span> <span class="pl-c1">OOMPSH</span>.<span class="pl-smi">configuration</span>
    , { admin, enduser } <span class="pl-k">=</span> <span class="pl-c1">OOMPSH</span>.<span class="pl-smi">api</span>

<span class="pl-c1">OOMPSH</span>.<span class="pl-smi">valid</span> <span class="pl-k">=</span> {
    local<span class="pl-k">:</span><span class="pl-sr">  <span class="pl-pds">/</span><span class="pl-k">^</span>https<span class="pl-k">?</span>:<span class="pl-cce">\/\/</span>(127<span class="pl-cce">\.</span>0<span class="pl-cce">\.</span>0<span class="pl-cce">\.</span>1<span class="pl-k">|</span>localhost)<span class="pl-pds">/</span></span>
  , domain<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>https<span class="pl-k">?</span>:<span class="pl-cce">\/\/</span><span class="pl-c1">[-:<span class="pl-c1">.</span><span class="pl-c1">a-z0-9</span>]</span><span class="pl-k">+</span><span class="pl-cce">\/</span><span class="pl-k">?</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>

  , oompshID<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">\d</span><span class="pl-c1">[<span class="pl-c1">a-z</span><span class="pl-c1">\d</span>]</span><span class="pl-k">{6}</span><span class="pl-k">$</span><span class="pl-pds">/</span></span> <span class="pl-c"><span class="pl-c">//</span> a digit, then six digits or l.c. letters</span>

    <span class="pl-c"><span class="pl-c">//</span>// Username, password and credentials.</span>
  , user<span class="pl-k">:</span>  <span class="pl-k">new</span> <span class="pl-en">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^(<span class="pl-s1"><span class="pl-pse">${</span>c1<span class="pl-pse">}${</span>c2<span class="pl-pse">}</span></span>{0,64})$<span class="pl-pds">`</span></span>)
  , pass<span class="pl-k">:</span>  <span class="pl-k">new</span> <span class="pl-en">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^(<span class="pl-s1"><span class="pl-pse">${</span>c1<span class="pl-pse">}${</span>c2<span class="pl-pse">}</span></span>{0,64})$<span class="pl-pds">`</span></span>)
  , creds<span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-en">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^<span class="pl-s1"><span class="pl-pse">${</span>c1<span class="pl-pse">}${</span>c2<span class="pl-pse">}</span></span>{0,64}:<span class="pl-s1"><span class="pl-pse">${</span>c1<span class="pl-pse">}${</span>c2<span class="pl-pse">}</span></span>{0,64}$<span class="pl-pds">`</span></span>)

  , apiv<span class="pl-k">:</span><span class="pl-sr">   <span class="pl-pds">/</span><span class="pl-k">^</span>v<span class="pl-c1">\d</span><span class="pl-k">+</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>
  , domain<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>https<span class="pl-k">?</span>:<span class="pl-cce">\/\/</span><span class="pl-c1">[-:<span class="pl-c1">.</span><span class="pl-c1">a-z0-9</span>]</span><span class="pl-k">+</span><span class="pl-cce">\/</span><span class="pl-k">?</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>
  , method<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>(GET<span class="pl-k">|</span>POST<span class="pl-k">|</span>OPTIONS)<span class="pl-k">$</span><span class="pl-pds">/</span></span>
  , action<span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-en">RegExp</span>( <span class="pl-s"><span class="pl-pds">`</span>^(<span class="pl-pds">`</span></span>
      <span class="pl-k">+</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(<span class="pl-smi">admin</span>.<span class="pl-c1">GET</span>).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>
      <span class="pl-k">+</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(<span class="pl-smi">admin</span>.<span class="pl-c1">POST</span>).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>
      <span class="pl-k">+</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(<span class="pl-smi">enduser</span>.<span class="pl-c1">GET</span>).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>
      <span class="pl-k">+</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(<span class="pl-smi">enduser</span>.<span class="pl-c1">POST</span>).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">'</span>|<span class="pl-pds">'</span></span>)
      <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">`</span>)$<span class="pl-pds">`</span></span> )

    <span class="pl-c"><span class="pl-c">//</span>// Filters.</span>
  , filter<span class="pl-k">:</span> {
        standard<span class="pl-k">:</span> { <span class="pl-c"><span class="pl-c">//</span>@TODO rename `user`</span>
            oompshID<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">\d</span><span class="pl-c1">[<span class="pl-c1">a-z</span><span class="pl-c1">\d</span>]</span><span class="pl-k">{6}</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>
          , usertype<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>(admin<span class="pl-k">|</span>enduser)<span class="pl-k">$</span><span class="pl-pds">/</span></span>
          , group<span class="pl-k">:</span><span class="pl-sr">    <span class="pl-pds">/</span><span class="pl-k">^</span>all<span class="pl-k">$</span><span class="pl-pds">/</span></span> } <span class="pl-c"><span class="pl-c">//</span> currently there is only one group</span>
      , bread<span class="pl-k">:</span> {
            posttype<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>(<span class="pl-c1">[_<span class="pl-c1">a-z</span>][-_<span class="pl-c1">a-z0-9</span>]</span><span class="pl-k">{0,32}</span>)<span class="pl-k">$</span><span class="pl-pds">/</span></span> }
    }
  <span class="pl-c"><span class="pl-c">//</span> , filter: /^.+$/ //@TODO a combination of all of the above?</span>

    <span class="pl-c"><span class="pl-c">//</span>// Body.</span>
  , notifyBody<span class="pl-k">:</span> { message<span class="pl-k">:</span><span class="pl-c1">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^.{1,<span class="pl-s1"><span class="pl-pse">${</span>mml<span class="pl-pse">}</span></span>}$<span class="pl-pds">`</span></span>) }
  , addBody<span class="pl-k">:</span> { id<span class="pl-k">:</span><span class="pl-sr"><span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">\d</span><span class="pl-k">+</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>, title<span class="pl-k">:</span> <span class="pl-c1">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^.{1,<span class="pl-s1"><span class="pl-pse">${</span>mtl<span class="pl-pse">}</span></span>}$<span class="pl-pds">`</span></span>) }
  , editBody<span class="pl-k">:</span> { id<span class="pl-k">:</span><span class="pl-sr"><span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">\d</span><span class="pl-k">+</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>, title<span class="pl-k">:</span> <span class="pl-c1">RegExp</span>(<span class="pl-s"><span class="pl-pds">`</span>^.{1,<span class="pl-s1"><span class="pl-pse">${</span>mtl<span class="pl-pse">}</span></span>}$<span class="pl-pds">`</span></span>) }
  , deleteBody<span class="pl-k">:</span> { id<span class="pl-k">:</span><span class="pl-sr"><span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">\d</span><span class="pl-k">+</span><span class="pl-k">$</span><span class="pl-pds">/</span></span> }
  , body<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-c1">.</span><span class="pl-k">+</span><span class="pl-k">$</span><span class="pl-pds">/</span></span> <span class="pl-c"><span class="pl-c">//</span>@TODO a combination of all of the above?</span>
}</pre></div>

<h2 id="fork">Fork</h2>
<p>TODO: How to install etc</p>

<h4><a id="user-content-heroku" class="anchor" aria-hidden="true" href="#heroku"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Heroku</h4>
<p>Once Heroku is set up, you can check for current environment (config) variables:<br>
<code>$ heroku run printenv</code></p>
<p>You’ll need to choose an admin username and password, and record it in the
<code>OOMPSH_ADMIN_CREDENTIALS</code> config var:<br>
<code>$ heroku config:set OOMPSH_ADMIN_CREDENTIALS=&lt;admin-username&gt;:&lt;admin-password&gt;</code></p>
<p>You can define any number of admin credentials this way, eg:<br>
<code>$ heroku config:set OOMPSH_ADMIN_CREDENTIALS=jo:pw,sam:pass,pat:foobar</code><br>
Note that oompsh.js throws an error on startup if any credentials are invalid.</p>
<p>After each <code>$ git commit</code> and <code>$ git push</code>, you should redeploy the app:<br>
<code>$ git push heroku master</code></p>
</article>



<h2 id="faq">FAQ</h2>
<p>TODO: add this section</p>


<!-- End section pasted from the repo -->
</div><!-- #main -->



<br><br><br><br><br><br>




</div><!--.container -->
</body>
</html>
